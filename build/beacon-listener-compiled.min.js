"use strict";var TOP="top";var RIGHT="right";var BOTTOM="bottom";var LEFT="left";var EVENT_TYPE_BEACON_FOUND="beacon-listener:found";var EVENT_TYPE_BEACON_LOST="beacon-listener:lost";var BeaconListener=function(){babelHelpers.createClass(e,[{key:"events",get:function n(){return me._events}}]);function e(n){babelHelpers.classCallCheck(this,e);var t=this,i=e,r,o;n=n||{beacons:".beacon",region:null,autoStart:false,pollInterval:100};t._config=n;t._MIN_TIMER_VAL=1;t._isListening=false;t._timerHandle=null;t._pollInterval=n.pollInterval;t._region=null;t._beaconList=null;t._beaconStates=[];t._beaconDOMNodes=[];t._fullyInside=false;t.listeners=[];r=n.beacons;o=n.region;if(r){t._handleBeaconsChange()}if(o){t._handleRegionChange()}t._handleFullyInsideChange();if(t.getConfig("autoStart")){t.start();i.later(t.getConfig("pollInterval"),t,t.check,null,false)}window.addEventListener("scroll",function(){return t._handleRegionChange});window.addEventListener("resize",function(){return t._handleRegionChange})}babelHelpers.createClass(e,[{key:"stop",value:function t(){var e=this;if(e._isListening===true&&e._timerHandle!==null){e._timerHandle.cancel();e._timerHandle=null;e._isListening=false}}},{key:"start",value:function i(){var n=this,t=e;if(t.isUndefined(n._timerHandler)&&!t.isUndefined(n._beaconList)&&n._beaconList!==null){n._isListening=true;n._timerHandle=t.later(n.getConfig("pollInterval"),n,n.check,null,true)}}},{key:"inViewportRegion",value:function r(n,t,i){return this.inRegion(n,e.viewportRegion(),t,i)}},{key:"inRegion",value:function o(n,t,i,r){var o={},a=e,l=r||a.getNodeRegion(n),s=t,u;if(s.tagName){o=a.getNodeRegion(s)}else if(a.isObject(t)){o=t}else{return false}if(i){return l[LEFT]>=o[LEFT]&&l[RIGHT]<=o[RIGHT]&&l[TOP]>=o[TOP]&&l[BOTTOM]<=o[BOTTOM]}else{u=a.getOffsets(o,l);return u[BOTTOM]>=u[TOP]&&u[RIGHT]>=u[LEFT]}}},{key:"check",value:function a(){var n=this,t=n._region,i=e,r;if(t===null){r=n.inViewportRegion}else{n._handleRegionChange();t=n._region;r=n.inRegion}[].forEach.call(n._beaconList,function(e,i){var o=n._beaconDOMNodes[i],a,l;if(t===null){l=[o,n._fullyInside]}else{l=[o,t,n._fullyInside]}a=r.apply(n,l);if(a&&n._beaconStates[i]!==true){n._beaconStates[i]=true;n.fireEvent(EVENT_TYPE_BEACON_FOUND,{listener:n,beacon:e},n)}else if(!a&&n._beaconStates[i]===true){n._beaconStates[i]=false;n.fireEvent(EVENT_TYPE_BEACON_LOST,{listener:n,beacon:e},n)}})}},{key:"fireEvent",value:function l(e,n,t){t=t||document;var i=new CustomEvent(e,{detail:n,target:this});t.dispatchEvent(i)}},{key:"addEventListener",value:function s(e,n){if(!(e in this.listeners)){this.listeners[e]=[]}this.listeners[e].push(n)}},{key:"removeEventListener",value:function u(e,n){if(!(e in this.listeners)){return}var t=this.listeners[e];for(var i=0,r=t.length;i<r;i++){if(t[i]===n){t.splice(i,1);return this.removeEventListener(e,n)}}}},{key:"dispatchEvent",value:function c(e){if(!(e.type in this.listeners)){return}var n=this.listeners[e.type];for(var t=0,i=n.length;t<i;t++){n[t].call(this,e)}document.dispatchEvent(e)}},{key:"getConfig",value:function f(e){if(this._config.hasOwnProperty(e)){return this._config[e]}return null}},{key:"isListening",value:function g(){return this._isListening}},{key:"_handleFullyInsideChange",value:function d(){var e=this;e._fullyInside=e.getConfig("fullyInside")}},{key:"_handleRegionChange",value:function v(){var e=this,n=e.getConfig("region");window.requestAnimationFrame(function(){e.recalcRegion(n)})}},{key:"_handleBeaconsChange",value:function h(){var n=this,t=e,i=n.getConfig("beacons");n._beaconDOMNodes=[];n._beaconList=t._getList(i);n._beaconStates=[].fill(false,n._beaconList.length);if(n._beaconList&&n._beaconList.length>0){[].forEach.call(n._beaconList,function(e,t){n._beaconStates[t]=false;n._beaconDOMNodes[t]=e})}}},{key:"recalcRegion",value:function _(n){var t=this,i,r=e;if(r.isUndefined(n)){n=t._region}if(r.isObject(n)&&r.isNumber(n[TOP])&&r.isNumber(n[RIGHT])&&r.isNumber(n[BOTTOM])&&r.isNumber(n[LEFT])){t._region=n;return}else{n=document.querySelector(n);if(n){i=r.getNodeRegion(n);if(i){t._region=i;return}}}t._region=null}}],[{key:"getOffsets",value:function y(e,n){var t={};t[TOP]=Math.max(e[TOP],n[TOP]);t[RIGHT]=Math.min(e[RIGHT],n[RIGHT]);t[BOTTOM]=Math.min(e[BOTTOM],n[BOTTOM]);t[LEFT]=Math.max(e[LEFT],n[LEFT]);return t}},{key:"later",value:function T(n,t,i,r,o){var a=[],l=e;n=n||0;if(!l.isUndefined(r)&&r){r=!l.isUndefined(r)?Array.isArray(r)?r:r.hasOwnProperty("slice")?Array.from(r):a:a}else{r=a}t=t||window;var s=false,u=t&&l.isString(i)?t[i]:i,c=function g(){if(!s){if(!u.apply){u(r[0],r[1],r[2],r[3])}else{u.apply(t,r||a)}}},f=o?setInterval(c,n):setTimeout(c,n);return{id:f,interval:o,cancel:function d(){s=true;if(this.interval){clearInterval(f)}else{clearTimeout(f)}}}}},{key:"isUndefined",value:function b(e){return typeof e==="undefined"}},{key:"isString",value:function m(e){return typeof e==="string"}},{key:"isObject",value:function p(n){var t=typeof n==="undefined"?"undefined":babelHelpers.typeof(n),i=e;return n&&(t==="object"||t==="function"||i.isFunction(n))||false}},{key:"isFunction",value:function O(e){return typeof e==="function"}},{key:"isNumber",value:function E(e){return typeof e==="number"&&isFinite(e)}},{key:"getNodeXY",value:function k(e){var n=window,t,i=false,r;if(e&&n){t=[n.pageXOffset,n.pageYOffset];r=e.getBoundingClientRect();i=[t[0]+r.left,t[1]+r.top]}return i}},{key:"_getList",value:function L(e){return document.querySelectorAll(e)}},{key:"viewportRegion",value:function R(n){n=n||document.body.parentNode;var t=false,i,r,o=e;if(n){i=n.offsetLeft;r=n.offsetTop;t=o._getRegion(r,o.winWidth(n)+i,r+o.winHeight(n),i)}return t}},{key:"_getRegion",value:function C(e,n,t,i){var r={};r[TOP]=r[1]=e;r[LEFT]=r[0]=i;r[BOTTOM]=t;r[RIGHT]=n;r.width=r[RIGHT]-r[LEFT];r.height=r[BOTTOM]-r[TOP];return r}},{key:"getNodeRegion",value:function w(n){var t,i=false;if(n){t=n.getBoundingClientRect();return e._getRegion(t.top,t.right,t.bottom,t.left)}return i}},{key:"_getWinSize",value:function N(e,n){n=n||document;var t=n.defaultView||n.parentWindow,i=n.compatMode,r=t.innerHeight,o=t.innerWidth,a=n.documentElement;if(i){if(i!="CSS1Compat"){a=n.body}r=a.clientHeight;o=a.clientWidth}return{height:r,width:o}}},{key:"winHeight",value:function S(n){return e._getWinSize(n).height}},{key:"winWidth",value:function H(n){return e._getWinSize(n).width}},{key:"docHeight",value:function I(n){var t=e,i=t._getDocSize(n).height;return Math.max(i,t._getWinSize(n).height)}},{key:"docWidth",value:function M(n){var t=e,i=t._getDocSize(n).width;return Math.max(i,t._getWinSize(n).width)}},{key:"_getDocSize",value:function B(){var e=e||document,n=e.documentElement;if(e.compatMode!="CSS1Compat"){n=e.body}return{height:n.scrollHeight,width:n.scrollWidth}}},{key:"docScrollX",value:function F(e){var n;e=e||document;return(((n=e.documentElement)||(n=e.body.parentNode))&&typeof n.scrollLeft=="number"?n:e.body).scrollLeft}},{key:"docScrollY",value:function P(e){var n;e=e||document;return(((n=e.documentElement)||(n=e.body.parentNode))&&typeof n.scrollTop=="number"?n:e.body).scrollTop}}]);return e}();
//# sourceMappingURL=/home/kris/workspace/beacon-listener/build/beacon-listener-compiled.min.js.map