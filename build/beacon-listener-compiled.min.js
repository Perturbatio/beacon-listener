"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol?"symbol":typeof e};var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(n,t,i){if(t)e(n.prototype,t);if(i)e(n,i);return n}}();function _classCallCheck(e,n){if(!(e instanceof n)){throw new TypeError("Cannot call a class as a function")}}var TOP="top";var RIGHT="right";var BOTTOM="bottom";var LEFT="left";var EVENT_TYPE_BEACON_FOUND="beacon-listener:found";var EVENT_TYPE_BEACON_LOST="beacon-listener:lost";var BeaconListener=function(){_createClass(e,[{key:"events",get:function n(){return me._events}}]);function e(n){_classCallCheck(this,e);var t=this,i=e,o,r;n=n||{beacons:".beacon",region:null,autoStart:false};t._config=n;t._MIN_TIMER_VAL=1;t._isListening=false;t._timerHandle=null;t._pollInterval=n["pollInterval"]=100;t._region=null;t._beaconList=null;t._beaconStates=[];t._beaconDOMNodes=[];t._fullyInside=false;t._events=[];o=n.beacons;r=n.region;if(o){t._handleBeaconsChange()}if(r){t._handleRegionChange()}t._handleFullyInsideChange();if(t.getConfig("autoStart")){t.start();i.later(t.getConfig("pollInterval"),t,t.check,null,false)}window.addEventListener("scroll",function(){return t._handleRegionChange});window.addEventListener("resize",function(){return t._handleRegionChange})}_createClass(e,[{key:"stop",value:function t(){var e=this;if(e._isListening===true&&e._timerHandle!==null){e._timerHandle.cancel();e._timerHandle=null;e._isListening=false}}},{key:"start",value:function i(){var n=this,t=e;if(t.isUndefined(n._timerHandler)&&!t.isUndefined(n._beaconList)&&n._beaconList!==null){n._isListening=true;n._timerHandle=t.later(n.getConfig("pollInterval"),n,n.check,null,true)}}},{key:"inViewportRegion",value:function o(n,t,i){return this.inRegion(n,e.viewportRegion(n),t,i)}},{key:"inRegion",value:function r(n,t,i,o){var r={},a=e,l=o||a.getNodeRegion(n),u=t,f;if(u.tagName){r=a.getNodeRegion(u)}else if(a.isObject(t)){r=t}else{return false}if(i){return l[LEFT]>=r[LEFT]&&l[RIGHT]<=r[RIGHT]&&l[TOP]>=r[TOP]&&l[BOTTOM]<=r[BOTTOM]}else{f=a.getOffsets(r,l);return f[BOTTOM]>=f[TOP]&&f[RIGHT]>=f[LEFT]}}},{key:"check",value:function a(){var n=this,t=n._region,i=e,o;if(t===null){o=n.inViewportRegion}else{n._handleRegionChange();t=n._region;o=n.inRegion}[].forEach.call(n._beaconList,function(e,r){var a=n._beaconDOMNodes[r],l,u;if(t===null){u=[a,n._fullyInside]}else{u=[a,t,n._fullyInside]}l=o.apply(n,u);if(l&&!n._beaconStates[r]){n._beaconStates[r]=true;i.fireEvent(EVENT_TYPE_BEACON_FOUND,{listener:n,beacon:e})}else if(!l&&n._beaconStates[r]){n._beaconStates[r]=false;i.fireEvent(EVENT_TYPE_BEACON_LOST,{listener:n,beacon:e})}})}},{key:"getConfig",value:function l(e){if(this._config.hasOwnProperty(e)){return this._config[e]}return null}},{key:"isListening",value:function u(){return this._isListening}},{key:"_handleFullyInsideChange",value:function f(){var e=this;e._fullyInside=e.getConfig("fullyInside")}},{key:"_handleRegionChange",value:function c(){console.log("_handleRegionChange");var e=this,n=e.getConfig("region");window.requestAnimationFrame(function(){e.recalcRegion(n)})}},{key:"_handleBeaconsChange",value:function s(){var n=this,t=e,i=n.getConfig("beacons");n._beaconStates=[];n._beaconDOMNodes=[];n._beaconList=t._getList(i);if(n._beaconList&&n._beaconList.length>0){[].forEach.call(n._beaconList,function(e,t){n._beaconStates[t]=false;n._beaconDOMNodes[t]=e})}}},{key:"recalcRegion",value:function g(n){var t=this,i,o=e;if(o.isUndefined(n)){n=t._region}if(o.isObject(n)){if(o.isNumber(n[TOP])&&o.isNumber(n[RIGHT])&&o.isNumber(n[BOTTOM])&&o.isNumber(n[LEFT])){t._region=n;return}else{n=document.querySelector(n);if(n){i=o.getNodeRegion(n);if(i){t._region=i;return}}}}t._region=null}}],[{key:"getOffsets",value:function d(e,n){var t={};t[TOP]=Math.max(e[TOP],n[TOP]);t[RIGHT]=Math.min(e[RIGHT],n[RIGHT]);t[BOTTOM]=Math.min(e[BOTTOM],n[BOTTOM]);t[LEFT]=Math.max(e[LEFT],n[LEFT]);return t}},{key:"fireEvent",value:function _(e,n,t){t=t||document;var i=new CustomEvent(e,{detail:n});t.dispatchEvent(i)}},{key:"later",value:function v(n,t,i,o,r){var a=[],l=e;n=n||0;if(!l.isUndefined(o)&&o){o=!l.isUndefined(o)?Array.isArray(o)?o:o.hasOwnProperty("slice")?Array.from(o):a:a}else{o=a}t=t||window;var u=false,f=t&&l.isString(i)?t[i]:i,c=function g(){if(!u){if(!f.apply){f(o[0],o[1],o[2],o[3])}else{f.apply(t,o||a)}}},s=r?setInterval(c,n):setTimeout(c,n);return{id:s,interval:r,cancel:function d(){u=true;if(this.interval){clearInterval(s)}else{clearTimeout(s)}}}}},{key:"isUndefined",value:function h(e){return typeof e==="undefined"}},{key:"isString",value:function y(e){return typeof e==="string"}},{key:"isObject",value:function T(n){var t=typeof n==="undefined"?"undefined":_typeof(n),i=e;return n&&(t==="object"||t==="function"||i.isFunction(n))||false}},{key:"isFunction",value:function b(e){return typeof e==="function"}},{key:"getNodeXY",value:function m(e){var n=window,t,i=false,o;if(e&&n){t=[n.pageXOffset,n.pageYOffset];o=e.getBoundingClientRect();i=[t[0]+o.left,t[1]+o.top]}return i}},{key:"_getList",value:function O(e){return document.querySelectorAll(e)}},{key:"viewportRegion",value:function p(n){n=n||document.body.parentNode;var t=false,i,o,r=e;if(n){i=n.offsetLeft;o=n.offsetTop;t=r._getRegion(o,r.winWidth(n)+i,o+r.winHeight(n),i)}return t}},{key:"_getRegion",value:function E(e,n,t,i){var o={};o[TOP]=o[1]=e;o[LEFT]=o[0]=i;o[BOTTOM]=t;o[RIGHT]=n;o.width=o[RIGHT]-o[LEFT];o.height=o[BOTTOM]-o[TOP];return o}},{key:"getNodeRegion",value:function k(n){var t,i=false;if(n){t=n.getBoundingClientRect();return e._getRegion(t.top,t.right,t.bottom,t.left)}return i}},{key:"_getWinSize",value:function C(e,n){n=n||document;var t=n.defaultView||n.parentWindow,i=n.compatMode,o=t.innerHeight,r=t.innerWidth,a=n.documentElement;if(i){if(i!="CSS1Compat"){a=n.body}o=a.clientHeight;r=a.clientWidth}return{height:o,width:r}}},{key:"winHeight",value:function L(n){return e._getWinSize(n).height}},{key:"winWidth",value:function R(n){return e._getWinSize(n).width}},{key:"docHeight",value:function S(n){var t=e,i=t._getDocSize(n).height;return Math.max(i,t._getWinSize(n).height)}},{key:"docWidth",value:function w(n){var t=e,i=t._getDocSize(n).width;return Math.max(i,t._getWinSize(n).width)}},{key:"_getDocSize",value:function N(){var e=e||document,n=e.documentElement;if(e.compatMode!="CSS1Compat"){n=e.body}return{height:n.scrollHeight,width:n.scrollWidth}}},{key:"docScrollX",value:function I(e){var n;e=e||document;return(((n=e.documentElement)||(n=e.body.parentNode))&&typeof n.scrollLeft=="number"?n:e.body).scrollLeft}},{key:"docScrollY",value:function M(e){var n;e=e||document;return(((n=e.documentElement)||(n=e.body.parentNode))&&typeof n.scrollTop=="number"?n:e.body).scrollTop}}]);return e}();
//# sourceMappingURL=/home/kris/workspace/beacon-listener/build/beacon-listener-compiled-compiled.min.js.map